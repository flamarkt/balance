(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var a in e)t.o(e,a)&&!t.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:e[a]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n),t.d(n,{common:()=>W,forum:()=>M});const e=flarum.core.compat["common/extend"],a=flarum.core.compat["common/components/LinkButton"];var o=t.n(a);const r=((flarum.extensions["flamarkt-core"]||{}).forum||{})["utils/AccountControls"];var c=t.n(r);const i=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/CartLayout"];var u=t.n(i);function s(t,n){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},s(t,n)}function l(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n)}const p=flarum.core.compat["common/Model"];var f=t.n(p),y=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return(n=t.call.apply(t,[this].concat(a))||this).amount=f().attribute("amount"),n.comment=f().attribute("comment"),n.createdAt=f().attribute("createdAt",f().transformDate),n}return l(n,t),n.prototype.apiEndpoint=function(){return"/flamarkt/balance/"+this.data.id},n}(f());const d=flarum.core.compat["forum/app"];var h=t.n(d);const b=flarum.core.compat["common/components/Page"];var v=t.n(b);const k=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["states/AbstractListState"];var g=function(t){function n(){return t.apply(this,arguments)||this}return l(n,t),n.prototype.type=function(){return"flamarkt/balance"},n}(t.n(k)());const B=flarum.core.compat["common/utils/ItemList"];var x=t.n(B);const P=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/AbstractAccountLayout"];var S=t.n(P);const A=((flarum.extensions["flamarkt-core"]||{}).common||{})["components/PriceLabel"];var O=t.n(A);const _=flarum.core.compat["common/helpers/humanTime"];var j=t.n(_),w=function(t){function n(){return t.apply(this,arguments)||this}l(n,t);var e=n.prototype;return e.className=function(){return"BalancePage"},e.title=function(){return"Balance"},e.content=function(){return m("div",this.sections().toArray())},e.sections=function(){var t,n=new(x());return n.add("current",m("p",["Current balance: ",m(O(),{value:null==(t=h().session.user)?void 0:t.attribute("flamarktBalance")})]),20),n.add("history",m("ul",this.attrs.state.pages.map((function(t){return t.items.map((function(t){return m("li",[j()(t.createdAt()),": ",m(O(),{value:t.amount()}),t.comment()?[" ",m("em","("+t.comment()+")")]:null])}))}))),10),n},n}(S()),L=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return(n=t.call.apply(t,[this].concat(a))||this).historyState=void 0,n}l(n,t);var e=n.prototype;return e.oninit=function(n){var e;t.prototype.oninit.call(this,n),this.historyState=new g({filter:{user:null==(e=h().session.user)?void 0:e.slug()}}),this.historyState.refresh()},e.view=function(){return w.component({state:this.historyState})},n}(v()),W={"models/History":y},M={"layouts/BalanceLayout":w,"pages/BalancePage":L,"states/HistoryState":g};app.initializers.add("flamarkt-balance",(function(){app.store.models["flamarkt-balance-history"]=y,app.routes["flamarkt.account.balance"]={path:"/account/balance",component:L},(0,e.extend)(c(),"controls",(function(t){t.add("balance",o().component({href:app.route("flamarkt.account.balance")},"Balance"))})),(0,e.extend)(u().prototype,"oninit",(function(){this.payWithBalance=!1})),(0,e.extend)(u().prototype,"sectionPayment",(function(t){var n=this,e=app.session.user.attribute("flamarktBalance");t.add("balance",m(".Form-group",[m("label",[m("input",{type:"checkbox",checked:this.payWithBalance,onchange:function(){n.payWithBalance=!n.payWithBalance},disabled:e<this.attrs.cart.priceTotal()||this.submitting})," Pay with balance (",O().component({value:e}),")"])]))})),(0,e.extend)(u().prototype,"data",(function(t){t.payWithBalance=this.payWithBalance}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map