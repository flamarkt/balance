(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};(()=>{"use strict";t.r(n),t.d(n,{common:()=>T,forum:()=>C});const e=flarum.core.compat["forum/app"];var o=t.n(e);const a=flarum.core.compat["common/extend"],r=flarum.core.compat["common/components/LinkButton"];var c=t.n(r);const i=((flarum.extensions["flamarkt-core"]||{}).forum||{})["utils/AccountControls"];var s=t.n(i);const u=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/CartLayout"];var l=t.n(u);function p(t,n){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},p(t,n)}function f(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,p(t,n)}const d=flarum.core.compat["common/Model"];var y=t.n(d),h=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return(n=t.call.apply(t,[this].concat(o))||this).amount=y().attribute("amount"),n.comment=y().attribute("comment"),n.createdAt=y().attribute("createdAt",y().transformDate),n.order=y().hasOne("order"),n}return f(n,t),n.prototype.apiEndpoint=function(){return"/flamarkt/balance/"+this.data.id},n}(y());const b=flarum.core.compat["common/components/Page"];var v=t.n(b);const k=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["states/AbstractListState"];var g=function(t){function n(){return t.apply(this,arguments)||this}return f(n,t),n.prototype.type=function(){return"flamarkt/balance"},n}(t.n(k)());const B=flarum.core.compat["common/utils/ItemList"];var x=t.n(B);const O=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/AbstractAccountLayout"];var P=t.n(O);const A=((flarum.extensions["flamarkt-core"]||{}).common||{})["components/PriceLabel"];var L=t.n(A);const _=flarum.core.compat["common/components/Link"];var j=t.n(_);const w=flarum.core.compat["common/helpers/humanTime"];var S=t.n(w),W=function(t){function n(){return t.apply(this,arguments)||this}f(n,t);var e=n.prototype;return e.className=function(){return"BalancePage"},e.title=function(){return"Balance"},e.content=function(){return m("div",this.sections().toArray())},e.sections=function(){var t,n=new(x());return n.add("current",m("p",["Current balance: ",m(L(),{value:null==(t=o().session.user)?void 0:t.attribute("flamarktBalance")})]),20),n.add("history",m("ul",this.attrs.list.pages.map((function(t){return t.items.map((function(t){return m("li",[S()(t.createdAt()),": ",m(L(),{value:t.amount()}),t.order()?[" ",m(j(),{href:o().route.order(t.order())},"Order #"+t.order().number())]:null,t.comment()?[" ",m("em","("+t.comment()+")")]:null])}))}))),10),n},n}(P()),M=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return(n=t.call.apply(t,[this].concat(o))||this).list=void 0,n}f(n,t);var e=n.prototype;return e.oninit=function(n){var e;t.prototype.oninit.call(this,n),this.list=new g({filter:{user:null==(e=o().session.user)?void 0:e.slug()}}),this.list.refresh()},e.view=function(){return W.component({list:this.list})},n}(v()),T={"models/History":h},C={"layouts/BalanceLayout":W,"pages/BalancePage":M,"states/HistoryListState":g};o().initializers.add("flamarkt-balance",(function(){o().store.models["flamarkt-balance-history"]=h,o().routes["flamarkt.account.balance"]={path:"/account/balance",component:M},(0,a.extend)(s(),"controls",(function(t){t.add("balance",c().component({href:o().route("flamarkt.account.balance")},"Balance"))})),(0,a.extend)(l().prototype,"oninit",(function(){this.payWithBalance=!1})),(0,a.extend)(l().prototype,"sectionPayment",(function(t){var n=this,e=o().session.user?o().session.user.attribute("flamarktBalance"):0;t.add("balance",m(".Form-group",[m("label",[m("input",{type:"checkbox",checked:this.payWithBalance,onchange:function(){n.payWithBalance=!n.payWithBalance},disabled:e<this.attrs.cart.priceTotal()||this.submitting})," Pay with balance (",L().component({value:e}),")"])]))})),(0,a.extend)(l().prototype,"data",(function(t){t.payWithBalance=this.payWithBalance}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map