(()=>{var t={n:a=>{var n=a&&a.__esModule?()=>a.default:()=>a;return t.d(n,{a:n}),n},d:(a,n)=>{for(var e in n)t.o(n,e)&&!t.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:n[e]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a),t.d(a,{common:()=>I,forum:()=>z});const n=flarum.core.compat["forum/app"];var e=t.n(n);const r=flarum.core.compat["common/extend"],o=flarum.core.compat["common/components/Button"];var c=t.n(o);const s=flarum.core.compat["common/components/Link"];var i=t.n(s);const u=flarum.core.compat["common/components/LinkButton"];var l=t.n(u);const f=flarum.core.compat["common/components/Switch"];var p=t.n(f);const d=flarum.core.compat["common/utils/ItemList"];var b=t.n(d);const y=((flarum.extensions["flamarkt-core"]||{}).common||{})["components/PriceLabel"];var h=t.n(y);const v=((flarum.extensions["flamarkt-core"]||{}).forum||{})["utils/AccountControls"];var k=t.n(v);const B=((flarum.extensions["flamarkt-core"]||{}).forum||{})["components/OrderFactPayment"];var g=t.n(B);const O=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/CartLayout"];var P=t.n(O);function L(t,a){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},L(t,a)}function A(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,L(t,a)}const w=flarum.core.compat["common/Model"];var x=t.n(w),S=function(t){function a(){for(var a,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(a=t.call.apply(t,[this].concat(e))||this).amount=x().attribute("amount"),a.comment=x().attribute("comment"),a.createdAt=x().attribute("createdAt",x().transformDate),a.order=x().hasOne("order"),a}return A(a,t),a.prototype.apiEndpoint=function(){return"/flamarkt/balance/"+this.data.id},a}(x());const _=flarum.core.compat["common/components/Page"];var j=t.n(_);const F=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["states/AbstractListState"];var M=function(t){function a(){return t.apply(this,arguments)||this}return A(a,t),a.prototype.type=function(){return"flamarkt/balance"},a}(t.n(F)());const T=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/AbstractAccountLayout"];var C=t.n(T);const D=flarum.core.compat["common/helpers/humanTime"];var W=t.n(D),H=function(t){function a(){return t.apply(this,arguments)||this}A(a,t);var n=a.prototype;return n.className=function(){return"BalancePage"},n.title=function(){return"Balance"},n.content=function(){return m("div",this.sections().toArray())},n.sections=function(){var t,a=new(b());return a.add("current",m("p",["Current balance: ",m(h(),{value:null==(t=e().session.user)?void 0:t.attribute("flamarktBalance")})]),20),a.add("history",m("ul",this.attrs.list.pages.map((function(t){return t.items.map((function(t){return m("li",[W()(t.createdAt()),": ",m(h(),{value:t.amount()}),t.order()?[" ",m(i(),{href:e().route.order(t.order())},"Order #"+t.order().number())]:null,t.comment()?[" ",m("em","("+t.comment()+")")]:null])}))}))),10),a},a}(C()),N=function(t){function a(){for(var a,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(a=t.call.apply(t,[this].concat(e))||this).list=void 0,a}A(a,t);var n=a.prototype;return n.oninit=function(a){var n;t.prototype.oninit.call(this,a),this.list=new M({filter:{user:null==(n=e().session.user)?void 0:n.slug()}}),this.list.refresh()},n.view=function(){return H.component({list:this.list})},a}(j()),I={"models/History":S},z={"layouts/BalanceLayout":H,"pages/BalancePage":N,"states/HistoryListState":M};e().initializers.add("flamarkt-balance",(function(){e().store.models["flamarkt-balance-history"]=S,e().routes["flamarkt.account.balance"]={path:"/account/balance",component:N},(0,r.extend)(k(),"controls",(function(t){t.add("balance",l().component({href:e().route("flamarkt.account.balance")},"Balance"))})),P().prototype.balancePaymentVisible=function(){return!e().forum.attribute("flamarktBalanceHidePaymentMethodNoFunds")},P().prototype.balanceLinks=function(t){var a=new(b());return e().session.user&&(t&&a.add("amount",e().translator.trans("flamarkt-balance.forum.cart.info.amount",{amount:h().component({value:e().session.user.attribute("flamarktBalance")})}),20),a.add("account",e().translator.trans("flamarkt-balance.forum.cart.info.account",{a:i().component({href:e().route("flamarkt.account.balance")})}),10)),a},(0,r.extend)(P().prototype,"oninit",(function(){this.submittingBalance=!1,this.savingBalance=!1})),(0,r.override)(P().prototype,"formDisabled",(function(t){return!(!this.submittingBalance&&!this.savingBalance)||t()})),(0,r.extend)(P().prototype,"partialPaymentOptions",(function(t){var a=this,n=e().session.user?e().session.user.attribute("flamarktBalance"):0,r=this.attrs.cart.attribute("payWithBalance"),o=n>=this.attrs.cart.priceTotal();o?t.add("balance-checkout",m(".Form-group",[c().component({className:"Button Button--primary",loading:this.submittingBalance,disabled:this.submitDisabled(),onclick:function(){a.submittingBalance=!0,a.submitOrder({payWithBalance:!0})}},e().translator.trans("flamarkt-balance.forum.cart.checkout"))])):t.add("balance-partial",m(".Form-group",[p().component({state:r,onchange:function(t){a.savingBalance=!0,a.attrs.cart.save({payWithBalance:t}).then((function(){a.savingBalance=!1,m.redraw()})).catch((function(t){throw a.savingBalance=!1,m.redraw(),t}))},disabled:this.formDisabled(),loading:this.savingBalance},e().translator.trans("flamarkt-balance.forum.cart.use",{amount:h().component({value:n})}))])),t.add("balance-links",m(".FlamarktBalanceLinks",this.balanceLinks(o).toArray()))})),(0,r.override)(P().prototype,"afterFailedSubmit",(function(t){return this.submittingBalance=!1,t()})),(0,r.override)(P().prototype,"partialPaymentCoversIncompleteAmount",(function(t){var a=e().session.user?e().session.user.attribute("flamarktBalance"):0;return!!(this.attrs.cart.attribute("payWithBalance")&&a<this.attrs.cart.priceTotal())||t()})),(0,r.override)(g().prototype,"label",(function(t){return"balance"===this.attrs.payment.method()?e().translator.trans("flamarkt-balance.forum.order.paymentLabel"):t()}))}))})(),module.exports=a})();
//# sourceMappingURL=forum.js.map